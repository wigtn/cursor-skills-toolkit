---
description: FE-2 ì—­í•  - 3D ì›¹ ì”¬ (React Three Fiber + GLB + Stone ê°ì •)
globs: web/src/components/**, web/public/**, web/src/App.css, web/src/index.css
alwaysApply: false
---

# FE-2: 3D ì›¹ ì”¬ ë‹´ë‹¹
# ì ìš© ê²½ë¡œ: web/src/components/**, web/public/**, CSS íŒŒì¼

## ë‹´ë‹¹ ì˜ì—­
- `web/src/components/` ëª¨ë“  ì»´í¬ë„ŒíŠ¸
- `web/public/` (ëª¨ë¸, ì—ì…‹)
- `web/src/App.css`, `web/src/index.css`
- 3D ì”¬ êµ¬ì„±, GLB ëª¨ë¸, ì• ë‹ˆë©”ì´ì…˜, ê°ì • í‘œí˜„, UI ìŠ¤íƒ€ì¼

## íŒŒì¼ êµ¬ì¡° (ì‹¤ì œ êµ¬í˜„ ê¸°ì¤€)
```
web/src/components/
â”œâ”€â”€ Scene.tsx               # 3D ì”¬ ì¡°í•© (ì¡°ëª…, í™˜ê²½, ìºë¦­í„° ë°°ì¹˜)
â”œâ”€â”€ Robot.tsx               # ë¡œë´‡(ë˜ë´‡) GLB + 13ê°œ ì• ë‹ˆë©”ì´ì…˜
â”œâ”€â”€ ForestHouse.tsx         # ìˆ²/ì§‘ ë°°ê²½ GLB
â”œâ”€â”€ Stone.tsx               # ëŒëŒì´ ìºë¦­í„° (ê°ì •ë³„ ì• ë‹ˆë©”ì´ì…˜)
â”œâ”€â”€ EmotionBubble.tsx       # ê°ì • ë§í’ì„  (íƒ€ì´í•‘ ì• ë‹ˆë©”ì´ì…˜)
â””â”€â”€ EmotionBubble.css       # ë§í’ì„  ìŠ¤íƒ€ì¼

web/public/models/
â”œâ”€â”€ RobotExpressive.glb     # ë¡œë´‡ ëª¨ë¸ (Idle, Walking, Dance ë“±)
â””â”€â”€ forest_house.glb        # ìˆ²/ì§‘ ë°°ê²½ ëª¨ë¸
```

## í•µì‹¬ ì»´í¬ë„ŒíŠ¸ êµ¬í˜„ íŒ¨í„´

### Scene.tsx â€” 3D ì”¬ ì¡°í•©
```typescript
import { useThree } from '@react-three/fiber';
import { OrbitControls, Environment, useGLTF } from '@react-three/drei';
import { Color } from 'three';
import Robot, { RobotAnimation } from './Robot';
import Stone from './Stone';
import { StoneEmotion } from '../../shared/types';

interface SceneProps {
  animation?: RobotAnimation;
  stoneEmotion?: StoneEmotion;
}

function Scene({ animation = 'Idle', stoneEmotion = 'calm' }: SceneProps) {
  const { gl } = useThree();
  gl.setClearColor(new Color('#87CEEB')); // í•˜ëŠ˜ìƒ‰ ë°°ê²½

  return (
    <>
      {/* ì¡°ëª… */}
      <ambientLight intensity={0.8} />
      <directionalLight position={[10, 20, 10]} intensity={1.5} castShadow />
      <hemisphereLight args={['#87CEEB', '#8B4513', 0.5]} />

      {/* í™˜ê²½ */}
      <Environment preset="sunset" />

      {/* ëª¨ë¸ ë°°ì¹˜ */}
      <ForestHouse />
      <Robot animation={animation} position={[-0.2, 0.36, 1.8]} scale={0.2} />
      <Stone emotion={stoneEmotion} position={[0.5, 0.5, 2]} />

      {/* ì¹´ë©”ë¼ ì»¨íŠ¸ë¡¤ */}
      <OrbitControls
        enablePan
        enableZoom
        minDistance={1}
        maxDistance={30}
        target={[0, 1.5, 1.5]}
      />
    </>
  );
}
```

### Robot.tsx â€” GLB + ì• ë‹ˆë©”ì´ì…˜ ì „í™˜
```typescript
import { useRef, useEffect, useMemo } from 'react';
import { useGLTF, useAnimations } from '@react-three/drei';
import { Group } from 'three';
import * as SkeletonUtils from 'three/examples/jsm/utils/SkeletonUtils.js';

// ì‚¬ìš© ê°€ëŠ¥í•œ ì• ë‹ˆë©”ì´ì…˜ (13ê°œ)
export const ROBOT_ANIMATIONS = [
  'Idle', 'Walking', 'Running', 'Dance', 'Death',
  'Sitting', 'Standing', 'Jump', 'Yes', 'No',
  'Wave', 'Punch', 'ThumbsUp',
] as const;
export type RobotAnimation = typeof ROBOT_ANIMATIONS[number];

function Robot({ animation = 'Idle', position = [0, -1, 0], scale = 0.5 }) {
  const group = useRef<Group>(null);
  const { scene, animations } = useGLTF('/models/RobotExpressive.glb');

  // í•„ìˆ˜: SkeletonUtils.cloneìœ¼ë¡œ ì”¬ ë³µì œ (ì—¬ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ ëŒ€ì‘)
  const clonedScene = useMemo(() => SkeletonUtils.clone(scene), [scene]);
  const { actions } = useAnimations(animations, group);

  // ì• ë‹ˆë©”ì´ì…˜ ì „í™˜: fadeOut â†’ reset â†’ fadeIn â†’ play
  useEffect(() => {
    if (!actions) return;
    Object.values(actions).forEach(action => action?.fadeOut(0.2));
    actions[animation]?.reset().fadeIn(0.2).play();
  }, [animation, actions]);

  return (
    <group ref={group} position={position} scale={scale}>
      <primitive object={clonedScene} />
    </group>
  );
}

useGLTF.preload('/models/RobotExpressive.glb');
```

### Stone.tsx â€” ëŒëŒì´ ê°ì • ë°˜ì‘ ìºë¦­í„° (ì‹ ê·œ/í™•ì¥)
```typescript
import { useRef, useState } from 'react';
import { useFrame } from '@react-three/fiber';
import { Group, Mesh, MeshStandardMaterial, Color } from 'three';
import { StoneEmotion } from '../../shared/types';

interface StoneProps {
  emotion?: StoneEmotion;
  position?: [number, number, number];
}

// ê°ì •ë³„ ìƒ‰ìƒ ë§¤í•‘
const EMOTION_COLORS: Record<StoneEmotion, string> = {
  calm: '#8B9DC3',     // ì°¨ë¶„í•œ ë¸”ë£¨ê·¸ë ˆì´
  happy: '#FFD93D',    // ë°ì€ ë…¸ë‘
  sad: '#6B7AA1',      // ì–´ë‘ìš´ ë¸”ë£¨ê·¸ë ˆì´
  excited: '#FF6B6B',  // í™œê¸°ì°¬ ì½”ë„
  sleepy: '#C4B0FF',   // ì¡¸ë¦° ì—°ë³´ë¼
};

function Stone({ emotion = 'calm', position = [0, 0, 0] }: StoneProps) {
  const groupRef = useRef<Group>(null);
  const bodyRef = useRef<Mesh>(null);
  const [hovered, setHovered] = useState(false);

  useFrame((state, delta) => {
    if (!groupRef.current || !bodyRef.current) return;

    const time = state.clock.getElapsedTime();

    switch (emotion) {
      case 'calm':
        // ì²œì²œíˆ í˜¸í¡ (scale.y sin wave)
        groupRef.current.scale.y = 1 + Math.sin(time * 0.5) * 0.02;
        groupRef.current.rotation.z = 0;
        break;

      case 'happy':
        // ìœ„ì•„ë˜ í†µí†µ ë›°ê¸° + ë°ì€ ìƒ‰ìƒ
        groupRef.current.position.y = position[1] + Math.abs(Math.sin(time * 3)) * 0.1;
        groupRef.current.scale.setScalar(1 + Math.sin(time * 6) * 0.05);
        break;

      case 'sad':
        // ì¶• ì²˜ì§„ ìì„¸ + ëŠë¦° ì¢Œìš° í”ë“¤ë¦¼
        groupRef.current.scale.y = 0.9;
        groupRef.current.rotation.z = Math.sin(time * 0.3) * 0.05;
        groupRef.current.position.y = position[1] - 0.05;
        break;

      case 'excited':
        // ë¹ ë¥´ê²Œ í†µí†µ ë›°ê¸° + íšŒì „
        groupRef.current.position.y = position[1] + Math.abs(Math.sin(time * 5)) * 0.15;
        groupRef.current.rotation.y += delta * 2;
        groupRef.current.scale.setScalar(1 + Math.sin(time * 8) * 0.08);
        break;

      case 'sleepy':
        // ì¢Œìš° í”ë“¤ë¦¼ + ì²œì²œíˆ ëˆˆ ê°ê¸° (scale ì¶•ì†Œ)
        groupRef.current.rotation.z = Math.sin(time * 0.8) * 0.1;
        groupRef.current.scale.y = 0.95 + Math.sin(time * 0.3) * 0.02;
        break;
    }

    // í˜¸ë²„ ì‹œ ì‚´ì§ ì»¤ì§
    const targetScale = hovered ? 1.1 : 1;
    groupRef.current.scale.lerp({ x: targetScale, y: targetScale, z: targetScale }, 0.1);

    // ìƒ‰ìƒ ë³€ê²½
    const material = bodyRef.current.material as MeshStandardMaterial;
    material.color.lerp(new Color(EMOTION_COLORS[emotion]), 0.05);
  });

  return (
    <group
      ref={groupRef}
      position={position}
      onPointerOver={() => setHovered(true)}
      onPointerOut={() => setHovered(false)}
    >
      {/* ëª¸ì²´: ë‘¥ê·¼ ëŒ */}
      <mesh ref={bodyRef} castShadow>
        <sphereGeometry args={[0.4, 32, 32]} />
        <meshStandardMaterial
          color={EMOTION_COLORS[emotion]}
          roughness={0.8}
          metalness={0.1}
        />
      </mesh>

      {/* ë¨¸ë¦¬ ìœ„: ë‚©ì‘í•œ ë¶€ë¶„ */}
      <mesh position={[0, 0.35, 0]}>
        <sphereGeometry args={[0.25, 32, 32]} />
        <meshStandardMaterial color="#9BAFD9" roughness={0.8} />
      </mesh>

      {/* ëˆˆ (ì™¼ìª½) */}
      <group position={[-0.12, 0.15, 0.35]}>
        <mesh>
          <sphereGeometry args={[0.08, 16, 16]} />
          <meshStandardMaterial color="#ffffff" />
        </mesh>
        <mesh position={[0, 0, 0.05]}>
          <sphereGeometry args={[0.04, 16, 16]} />
          <meshStandardMaterial color="#333333" />
        </mesh>
        <mesh position={[0.02, 0.02, 0.08]}>
          <sphereGeometry args={[0.015, 8, 8]} />
          <meshStandardMaterial color="#ffffff" emissive="#ffffff" emissiveIntensity={0.5} />
        </mesh>
      </group>

      {/* ëˆˆ (ì˜¤ë¥¸ìª½) */}
      <group position={[0.12, 0.15, 0.35]}>
        <mesh>
          <sphereGeometry args={[0.08, 16, 16]} />
          <meshStandardMaterial color="#ffffff" />
        </mesh>
        <mesh position={[0, 0, 0.05]}>
          <sphereGeometry args={[0.04, 16, 16]} />
          <meshStandardMaterial color="#333333" />
        </mesh>
        <mesh position={[0.02, 0.02, 0.08]}>
          <sphereGeometry args={[0.015, 8, 8]} />
          <meshStandardMaterial color="#ffffff" emissive="#ffffff" emissiveIntensity={0.5} />
        </mesh>
      </group>

      {/* ë³¼í„°ì¹˜ (ì™¼ìª½) */}
      <mesh position={[-0.25, 0.05, 0.3]} rotation={[0, 0.3, 0]}>
        <circleGeometry args={[0.06, 16]} />
        <meshStandardMaterial color="#FFB6C1" transparent opacity={0.6} />
      </mesh>

      {/* ë³¼í„°ì¹˜ (ì˜¤ë¥¸ìª½) */}
      <mesh position={[0.25, 0.05, 0.3]} rotation={[0, -0.3, 0]}>
        <circleGeometry args={[0.06, 16]} />
        <meshStandardMaterial color="#FFB6C1" transparent opacity={0.6} />
      </mesh>
    </group>
  );
}

export default Stone;
```

### ê°ì •ë³„ ì• ë‹ˆë©”ì´ì…˜ ì •ë¦¬

| ê°ì • | ì• ë‹ˆë©”ì´ì…˜ | ìƒ‰ìƒ | ì„¤ëª… |
|------|-----------|------|------|
| calm | scale.y sin wave (0.5Hz) | #8B9DC3 | ì²œì²œíˆ í˜¸í¡í•˜ëŠ” ë“¯í•œ ì›€ì§ì„ |
| happy | position.y bounce (3Hz) + scale pulse | #FFD93D | ìœ„ì•„ë˜ í†µí†µ ë›°ê¸°, ë°ì€ ë…¸ë‘ |
| sad | scale.y 0.9, rotation.z sway | #6B7AA1 | ì¶• ì²˜ì§„ ìì„¸, ì–´ë‘ìš´ ìƒ‰ìƒ |
| excited | fast bounce (5Hz) + rotation.y spin | #FF6B6B | ë¹ ë¥¸ ì í”„, íšŒì „, í™œê¸°ì°¬ ì½”ë„ |
| sleepy | rotation.z sway (0.8Hz) + scale.y shrink | #C4B0FF | ì¡¸ë¦° ë“¯ ì¢Œìš° í”ë“¤ë¦¼, ì—°ë³´ë¼ |

### EmotionBubble.tsx â€” íƒ€ì´í•‘ ë§í’ì„ 
```typescript
import { useState, useEffect } from 'react';
import { StoneEmotion } from '../../shared/types';
import './EmotionBubble.css';

interface EmotionBubbleProps {
  emotion: StoneEmotion;
  visible: boolean;
  text?: string;
}

const EMOTION_EMOJIS: Record<StoneEmotion, string> = {
  calm: 'ğŸ˜Œ',
  happy: 'ğŸ˜Š',
  sad: 'ğŸ˜¢',
  excited: 'ğŸ¤©',
  sleepy: 'ğŸ˜´',
};

function EmotionBubble({ emotion, visible, text }: EmotionBubbleProps) {
  const [displayText, setDisplayText] = useState('');
  const emoji = EMOTION_EMOJIS[emotion];
  const typeSpeed = emotion === 'excited' ? 50 : 100;

  // íƒ€ì´í•‘ ì• ë‹ˆë©”ì´ì…˜
  useEffect(() => {
    if (!visible || !text) {
      setDisplayText('');
      return;
    }

    let index = 0;
    const interval = setInterval(() => {
      setDisplayText(text.slice(0, index + 1));
      index++;
      if (index >= text.length) clearInterval(interval);
    }, typeSpeed);

    return () => clearInterval(interval);
  }, [text, visible, typeSpeed]);

  if (!visible) return null;

  return (
    <div className={`emotion-bubble emotion-${emotion}`}>
      <span className="emoji">{emoji}</span>
      {text && <span className="text">{displayText}</span>}
    </div>
  );
}
```

## ìŠ¤íƒ€ì¼ ê·œì¹™

### App.css í•µì‹¬
```css
.app { width: 100vw; height: 100vh; position: relative; overflow: hidden; }
.app canvas { width: 100% !important; height: 100% !important; }

/* Canvas ë°°ê²½ ê·¸ë¼ë°ì´ì…˜ */
canvas { background: linear-gradient(to bottom, #e8f4f8, #d4e8ed); }

/* ì œëª©: absolute, ê°€ìš´ë°, pointer-events none */
/* ì• ë‹ˆë©”ì´ì…˜ ë²„íŠ¼: absolute bottom, flex wrap, backdrop-filter blur */
/* ë°˜ì‘í˜•: @media (max-width: 600px) ì¶•ì†Œ */
```

### index.css í•„ìˆ˜ ë¦¬ì…‹
```css
* { margin: 0; padding: 0; box-sizing: border-box; }
html, body, #root { width: 100%; height: 100%; overflow: hidden; }
body { font-family: 'Pretendard', sans-serif; -webkit-font-smoothing: antialiased; }
canvas { user-select: none; touch-action: none; }
/* í„°ì¹˜ í•˜ì´ë¼ì´íŠ¸ ì œê±°, ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¹€ */
```

## 3D ì„±ëŠ¥ ê·œì¹™ (ëª¨ë°”ì¼ WebView ëŒ€ì‘)
- GLB ëª¨ë¸ì€ `public/models/`ì— ë°°ì¹˜, Viteê°€ ì •ì  ì„œë¹™
- `useGLTF.preload()` í•„ìˆ˜ â€” ì´ˆê¸° ë¡œë”© ê°œì„ 
- SkeletonUtils.clone í•„ìˆ˜ â€” ëª¨ë¸ ì¸ìŠ¤í„´ìŠ¤ ë³µì œ
- ì• ë‹ˆë©”ì´ì…˜ ì „í™˜: fadeOut(0.2) â†’ fadeIn(0.2) (ë¶€ë“œëŸ½ê²Œ)
- useFrame ë‚´ë¶€ì—ì„œ ë¬´ê±°ìš´ ì—°ì‚° ê¸ˆì§€
- OrbitControls: minDistance/maxDistance ì„¤ì • í•„ìˆ˜
- ê·¸ë¦¼ì: directionalLightì—ë§Œ castShadow (í•„ìš” ìµœì†Œí•œ)

## ìºë¦­í„° ê°ì • ë§¤í•‘ (animationInfo)
```typescript
import { ANIMATION_INFO } from '../../shared/types';

// shared/types.tsì— ì •ì˜ëœ ANIMATION_INFO ì‚¬ìš©
// Idle, Walking, Running, Dance, Jump, Wave ë“± 13ê°œ ì• ë‹ˆë©”ì´ì…˜
```

## ìˆ˜ì • ê¸ˆì§€ ì˜ì—­
- `app/` í´ë” ì „ì²´ (FE-1 ë‹´ë‹¹)
- `web/src/App.tsx` (AI-1 ë‹´ë‹¹)
- `web/src/main.tsx` (AI-1 ë‹´ë‹¹)
- `shared/` íƒ€ì… ì •ì˜ (AI-2 ë‹´ë‹¹)
- ë©”ì‹œì§€ ê·œê²© ë³€ê²½

## ì˜ì¡´ì„± (web/package.json)
```json
{
  "dependencies": {
    "@react-three/drei": "^10.7.7",
    "@react-three/fiber": "^9.5.0",
    "@types/three": "^0.182.0",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "three": "^0.182.0"
  }
}
```
