---
globs: "src/**/*.{ts,tsx}"
description: "성능 최적화 및 UX 패턴"
---

# Performance & UX Rules

## 로딩 상태
- 모든 비동기 작업에 로딩 UI 필수
- 페이지 단위: `loading.tsx` 활용
- 컴포넌트 단위: Suspense + 스켈레톤

```typescript
// 스켈레톤 패턴
function SkeletonCard() {
  return (
    <div className="animate-pulse space-y-4 rounded-xl border p-6">
      <div className="h-4 w-3/4 rounded bg-gray-200" />
      <div className="h-4 w-1/2 rounded bg-gray-200" />
      <div className="h-20 rounded bg-gray-200" />
    </div>
  );
}
```

## 이미지 최적화
- `next/image` 필수 사용 (img 태그 금지)
- `width`, `height` 또는 `fill` 반드시 지정
- `priority` 속성은 Above-the-fold 이미지에만

## 코드 분할
- 동적 import로 무거운 컴포넌트 분리
```typescript
import dynamic from 'next/dynamic';

const HeavyChart = dynamic(() => import('@/components/features/Chart'), {
  loading: () => <SkeletonChart />,
});
```

## AI 응답 UX
- 스트리밍으로 점진적 표시 (타이핑 효과)
- 분석 중 상태 표시 (진행률 또는 스피너 + 메시지)
- 에러 시 재시도 버튼 제공
- timeout 시 사용자 친화적 메시지

```typescript
// AI 스트리밍 표시
function StreamingText({ content }: { content: string }) {
  return (
    <div className="prose max-w-none">
      {content}
      <span className="inline-block w-2 h-5 bg-primary animate-pulse ml-1" />
    </div>
  );
}
```

## 에러 UI
```typescript
// error.tsx 패턴
"use client";

export default function Error({
  error,
  reset,
}: {
  error: Error & { digest?: string };
  reset: () => void;
}) {
  return (
    <div className="flex flex-col items-center justify-center gap-4 py-20">
      <h2 className="text-xl font-semibold">문제가 발생했습니다</h2>
      <p className="text-gray-600">{error.message}</p>
      <button
        onClick={reset}
        className="rounded-lg bg-primary px-4 py-2 text-white hover:bg-primary-hover"
      >
        다시 시도
      </button>
    </div>
  );
}
```
