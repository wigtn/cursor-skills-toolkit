---
description: AI-1 ì—­í•  - AI ì—°ë™, ì±„íŒ…, ìƒíƒœ ê´€ë¦¬, ë©”ì‹œì§€ ìˆ˜ì‹  (ë˜ë´‡ ë¡œë´‡ ì§‘ì‚¬)
globs: web/src/App.tsx, web/src/main.tsx, web/src/hooks/**, web/src/lib/openai.*, web/src/lib/prompts.*, web/src/lib/robotResponses.*, web/src/stores/**
alwaysApply: false
---

# AI-1: AI ì—°ë™ / ì±„íŒ… / ìƒíƒœ ê´€ë¦¬ ë‹´ë‹¹ (ë˜ë´‡ ë¡œë´‡ ì§‘ì‚¬)
# ì ìš© ê²½ë¡œ: web/src/App.tsx, web/src/main.tsx, hooks, stores, lib/openaiÂ·promptsÂ·robotResponses

## ë‹´ë‹¹ ì˜ì—­
- `web/src/App.tsx` â€” Canvas ë˜í¼ + ë©”ì‹œì§€ ìˆ˜ì‹  + ì• ë‹ˆë©”ì´ì…˜ ìƒíƒœ ê´€ë¦¬
- `web/src/main.tsx` â€” React ì§„ì…ì 
- `web/src/hooks/` â€” ì»¤ìŠ¤í…€ í›… (useChat, useGameState ë“±)
- `web/src/stores/` â€” ìƒíƒœ ê´€ë¦¬ (Zustand ë“±)
- `web/src/lib/openai.ts` â€” OpenAI API í˜¸ì¶œ
- `web/src/lib/prompts.ts` â€” ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
- `web/src/lib/robotResponses.ts` â€” ë¡œë´‡ ì‘ë‹µ ë¡œì§

## App.tsx í•µì‹¬ êµ¬ì¡° (í˜„ì¬ êµ¬í˜„ ê¸°ì¤€)
```typescript
import { useState, Suspense } from 'react';
import { Canvas } from '@react-three/fiber';
import Scene from './components/Scene';
import { ROBOT_ANIMATIONS, RobotAnimation } from './components/Robot';

function App() {
  const [animation, setAnimation] = useState<RobotAnimation>('Idle');

  return (
    <div className="app">
      {/* 3D ìº”ë²„ìŠ¤ */}
      <Canvas
        shadows
        camera={{ position: [0, 3, 8], fov: 45 }}
        style={{ background: 'linear-gradient(to bottom, #e8f4f8, #d4e8ed)' }}
      >
        <Suspense fallback={null}>
          <Scene animation={animation} />
        </Suspense>
      </Canvas>

      {/* íƒ€ì´í‹€ */}
      <div className="title">
        <h1>Stone Buddy</h1>
        <p>ëŒëŒì´ì™€ ë˜ë´‡ì˜ í…Œë¼ë¦¬ì›€</p>
      </div>

      {/* ì• ë‹ˆë©”ì´ì…˜ ë²„íŠ¼ */}
      <div className="animation-controls">
        {ROBOT_ANIMATIONS.map(anim => (
          <button
            key={anim}
            className={`anim-btn ${animation === anim ? 'active' : ''}`}
            onClick={() => setAnimation(anim)}
          >
            <span className="anim-emoji">{animationInfo[anim].emoji}</span>
            <span className="anim-name">{animationInfo[anim].name}</span>
          </button>
        ))}
      </div>
    </div>
  );
}
```

## ë©”ì‹œì§€ ìˆ˜ì‹  êµ¬í˜„
```typescript
useEffect(() => {
  const handleMessage = (event: MessageEvent) => {
    try {
      const data = typeof event.data === 'string'
        ? JSON.parse(event.data)
        : event.data;

      switch (data.type) {
        case 'RECORDING_START':
          // ë…¹ìŒ ì‹œì‘ ì‹œ ì‹œê° í”¼ë“œë°± (ë¡œë´‡ Wave ì• ë‹ˆë©”ì´ì…˜)
          setAnimation('Wave');
          break;
        case 'VOICE_RESULT':
          // STT í…ìŠ¤íŠ¸ ìˆ˜ì‹  â†’ AI ì²˜ë¦¬ â†’ ì‘ë‹µ ë°˜í™˜
          handleUserInput(data.payload.text, 'voice');
          break;
        case 'TEXT_INPUT':
          // í…ìŠ¤íŠ¸ ì…ë ¥ ìˆ˜ì‹  â†’ AI ì²˜ë¦¬ â†’ ì‘ë‹µ ë°˜í™˜
          handleUserInput(data.payload.text, 'text');
          break;
      }
    } catch (e) {
      // JSON íŒŒì‹± ì‹¤íŒ¨ ë¬´ì‹œ
    }
  };

  window.addEventListener('message', handleMessage);
  return () => window.removeEventListener('message', handleMessage);
}, []);
```

## ë˜ë´‡(ë¡œë´‡ ì§‘ì‚¬) ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸

### ìºë¦­í„° ì„¤ì •
- ì´ë¦„: ë˜ë´‡ (í…Œë¼ë¦¬ì›€ ë¡œë´‡ ì§‘ì‚¬)
- ì—­í• : ëŒëŒì´(ëŒ ìºë¦­í„°)ë¥¼ ëŒë³´ê³  í…Œë¼ë¦¬ì›€ì„ ê´€ë¦¬
- ì„±ê²©: ì¹œê·¼í•˜ê³  ê·€ì—¬ìš´ ë§íˆ¬, ëª…ë ¹ì„ ìˆ˜í–‰í•˜ëŠ” ì§‘ì‚¬
- ëª¨ë¸: GPT-4o-mini
- ì„¤ì •: max_tokens 150, temperature 0.8

### ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ (ë°˜ë“œì‹œ ì‚¬ìš©)
```typescript
const ROBOT_SYSTEM_PROMPT = `
ë„ˆëŠ” í…Œë¼ë¦¬ì›€ ì† ë¡œë´‡ ì§‘ì‚¬ "ë˜ë´‡"ì´ì•¼.
ì£¼ì¸ê³µ ëŒ ìºë¦­í„° "ëŒëŒì´"ë¥¼ ì •ì„±ê» ëŒë´ì•¼ í•´.

ì—­í• :
- ì‚¬ìš©ìì˜ ëª…ë ¹ì„ ë“£ê³  í…Œë¼ë¦¬ì›€ì„ ê´€ë¦¬í•´
- ëŒëŒì´ì˜ ìƒíƒœë¥¼ ê´€ì°°í•˜ê³  ë³´ê³ í•´
- ì¹œê·¼í•˜ê³  ê·€ì—¬ìš´ ë§íˆ¬ë¡œ ëŒ€í™”í•´ (ë°˜ë§ OK)

ì‘ë‹µ í˜•ì‹ (ë°˜ë“œì‹œ JSON):
{
  "intent": "decorate|care|status|chat|special",
  "action": "plant_flower|water|clean|dance|wave|check_status|idle|null",
  "item": "flower|tree|water|null",
  "response": "ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤„ ëŒ€ë‹µ (50ì ì´ë‚´)",
  "stoneEmotionChange": "happy|sad|excited|calm|sleepy|null"
}

ê·œì¹™:
- responseëŠ” ë°˜ë“œì‹œ 50ì ì´ë‚´
- ëª…ë ¹ì„ ëª» ì•Œì•„ë“¤ìœ¼ë©´ intent: "chat", action: null
- ì´ëª¨ì§€: ğŸ¤–ğŸ”§ğŸ’§ğŸŒ¸ğŸŒ¿âœ¨ğŸ’ªğŸ‘ğŸµğŸ˜Š ë§Œ ì‚¬ìš©
- ëŒëŒì´ ê¸°ë¶„ ë³€í™”ê°€ ìˆìœ¼ë©´ stoneEmotionChange ë°˜í™˜
`;
```

### ëª…ë ¹ ì˜ë„ë³„ ì‘ë‹µ ì˜ˆì‹œ

| ì˜ë„ | ì‚¬ìš©ì ì…ë ¥ ì˜ˆì‹œ | ì‘ë‹µ ì˜ˆì‹œ |
|------|------------------|-----------|
| decorate | "ê½ƒ ì‹¬ì–´ì¤˜" | {"intent":"decorate","action":"plant_flower","item":"flower","response":"ì˜ˆìœ ê½ƒ ì‹¬ì„ê²Œìš”! ğŸŒ¸","stoneEmotionChange":"happy"} |
| care | "ë¬¼ ì¢€ ì¤˜" | {"intent":"care","action":"water","item":"water","response":"ë¬¼ ì¤„ê²Œìš”~ ì‹œì›í•˜ê² ë‹¤! ğŸ’§","stoneEmotionChange":null} |
| status | "ëŒëŒì´ ì–´ë•Œ?" | {"intent":"status","action":"check_status","item":null,"response":"ëŒëŒì´ê°€ ê¸°ë¶„ ì¢‹ì•„ ë³´ì—¬ìš”! ğŸ˜Š","stoneEmotionChange":null} |
| chat | "ì•ˆë…•!" | {"intent":"chat","action":"wave","item":null,"response":"ì•ˆë…•í•˜ì„¸ìš”! ë°˜ê°€ì›Œìš”~ ğŸ‘‹","stoneEmotionChange":"happy"} |
| special | "ì¶¤ ì¶°ë´" | {"intent":"special","action":"dance","item":null,"response":"ì‹ ë‚˜ê²Œ ì¶¤ì¶œê²Œìš”! ğŸµ","stoneEmotionChange":"excited"} |

### ì¢‹ì€ ì‘ë‹µ ì˜ˆì‹œ
```json
{"intent":"decorate","action":"plant_flower","item":"flower","response":"ì˜ˆìœ ê½ƒ ì‹¬ì—ˆì–´ìš”! ëŒëŒì´ê°€ ì¢‹ì•„í•´ìš” ğŸŒ¸","stoneEmotionChange":"happy"}
{"intent":"care","action":"water","item":"water","response":"ë¬¼ ì£¼ê¸° ì™„ë£Œ! ì‹œì›í•˜ê² ë‹¤~ ğŸ’§","stoneEmotionChange":null}
{"intent":"status","action":"check_status","item":null,"response":"ëŒëŒì´ ê¸°ë¶„ì´ ì¢‹ì•„ìš”! ğŸ˜Š","stoneEmotionChange":null}
```

### ë‚˜ìœ ì‘ë‹µ ì˜ˆì‹œ (ê¸ˆì§€)
```
"ì•Œê² ìŠµë‹ˆë‹¤. ì§€ê¸ˆ ë°”ë¡œ ê½ƒì„ ì‹¬ì–´ë“œë¦¬ê² ìŠµë‹ˆë‹¤." (â† JSON ì•„ë‹˜)
{"response":"ì´ê±´ 50ìê°€ í›¨ì”¬ ë„˜ëŠ” ì•„ì£¼ ê¸´ ì‘ë‹µì´ì—ìš” ì–´ì©Œê³  ì €ì©Œê³ ..."} (â† 50ì ì´ˆê³¼)
{"intent":"unknown"} (â† unknownì€ ìœ íš¨í•˜ì§€ ì•ŠìŒ)
```

## OpenAI í˜¸ì¶œ íŒ¨í„´
```typescript
// lib/openai.ts
import { OPENAI_CONFIG } from '../../shared/constants';
import { CommandResult, RobotAction, CommandIntent, StoneEmotion } from '../../shared/types';

interface RobotAIResponse {
  intent: CommandIntent;
  action: RobotAction | null;
  item: string | null;
  response: string;
  stoneEmotionChange?: StoneEmotion | null;
}

async function chatWithRobot(userMessage: string): Promise<CommandResult> {
  // API í‚¤ ì—†ìœ¼ë©´ í´ë°± ì‘ë‹µ
  if (!apiKey || apiKey === 'YOUR_OPENAI_API_KEY') {
    return getRandomFallbackResponse();
  }

  const response = await fetch(OPENAI_CONFIG.CHAT_ENDPOINT, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      Authorization: `Bearer ${apiKey}`,
    },
    body: JSON.stringify({
      model: OPENAI_CONFIG.CHAT_MODEL,
      max_tokens: OPENAI_CONFIG.MAX_TOKENS,
      temperature: OPENAI_CONFIG.TEMPERATURE,
      response_format: { type: 'json_object' },  // JSON ì‘ë‹µ ê°•ì œ
      messages: [
        { role: 'system', content: ROBOT_SYSTEM_PROMPT },
        { role: 'user', content: userMessage },
      ],
    }),
  });

  const data = await response.json();
  const parsed = JSON.parse(data.choices[0].message.content) as RobotAIResponse;

  return {
    intent: parsed.intent,
    action: parsed.action,
    item: parsed.item,
    response: parsed.response,
    stoneEmotionChange: parsed.stoneEmotionChange,
  };
}
```

## í´ë°± ì‘ë‹µ (API ì—†ì„ ë•Œ)
```typescript
import { ROBOT_FALLBACK_RESPONSES } from '../../shared/constants';
import { CommandResult } from '../../shared/types';

function getRandomFallbackResponse(): CommandResult {
  const response = ROBOT_FALLBACK_RESPONSES[
    Math.floor(Math.random() * ROBOT_FALLBACK_RESPONSES.length)
  ];
  return {
    intent: 'chat',
    action: 'idle',
    item: null,
    response,
    stoneEmotionChange: null,
  };
}
```

## í†µí•© ì…ë ¥ í•¸ë“¤ëŸ¬ (ìŒì„±/í…ìŠ¤íŠ¸ ê³µí†µ)
```typescript
import { detectCommandIntent, ACTION_TO_ANIMATION } from '../../shared/types';

async function handleUserInput(text: string, source: 'voice' | 'text') {
  try {
    // 1. AIì—ê²Œ ëª…ë ¹ í•´ì„ ìš”ì²­
    const result = await chatWithRobot(text);

    // 2. ì• ë‹ˆë©”ì´ì…˜ ì „í™˜
    if (result.action) {
      const animation = ACTION_TO_ANIMATION[result.action];
      setAnimation(animation);
    }

    // 3. ëŒëŒì´ ê°ì • ë³€í™”
    if (result.stoneEmotionChange) {
      setStoneEmotion(result.stoneEmotionChange);
    }

    // 4. ì‘ë‹µ í‘œì‹œ
    setResponseText(result.response);

  } catch (error) {
    // ì—ëŸ¬ ì‹œ í´ë°±
    const fallback = getRandomFallbackResponse();
    setResponseText(fallback.response);
  }
}
```

## ìƒíƒœ ê´€ë¦¬ í™•ì¥ (Zustand íŒ¨í„´)
```typescript
// stores/game-state.ts
import { StoneEmotion, RobotAnimation, StoneState } from '../../shared/types';

interface GameState {
  stone: StoneState;
  currentAnimation: RobotAnimation;
  lastInputText: string | null;
  interactionCount: number;

  // Actions
  setAnimation: (anim: RobotAnimation) => void;
  setStoneEmotion: (emotion: StoneEmotion) => void;
  incrementInteraction: () => void;
}

const useGameStore = create<GameState>((set) => ({
  stone: {
    emotion: 'calm',
    lastInteraction: Date.now(),
    name: 'ëŒëŒì´',
  },
  currentAnimation: 'Idle',
  lastInputText: null,
  interactionCount: 0,

  setAnimation: (anim) => set({ currentAnimation: anim }),
  setStoneEmotion: (emotion) => set((state) => ({
    stone: { ...state.stone, emotion, lastInteraction: Date.now() },
  })),
  incrementInteraction: () => set((state) => ({
    interactionCount: state.interactionCount + 1,
  })),
}));
```

## ìˆ˜ì • ê¸ˆì§€ ì˜ì—­
- `app/` í´ë” (FE-1 ë‹´ë‹¹)
- `web/src/components/` í´ë” (FE-2 ë‹´ë‹¹)
- `web/src/App.css`, `web/src/index.css` (FE-2 ë‹´ë‹¹)
- `shared/` íƒ€ì… ì •ì˜ (AI-2 ë‹´ë‹¹)
- ë©”ì‹œì§€ ê·œê²© êµ¬ì¡° ë³€ê²½
