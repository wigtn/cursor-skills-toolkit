---
description: "expo-threeë¥¼ ì‚¬ìš©í•œ ëª¨ë°”ì¼ 3D ë Œë”ë§ ê·œì¹™"
globs:
  - "components/Terrarium/**/*.tsx"
  - "lib/three/**/*.ts"
alwaysApply: false
---

# expo-three ëª¨ë°”ì¼ 3D ê·œì¹™

## í•„ìˆ˜ import
```typescript
import { GLView, ExpoWebGLRenderingContext } from 'expo-gl';
import { Renderer } from 'expo-three';
import * as THREE from 'three';
```

## TerrariumScene ê¸°ë³¸ íŒ¨í„´
```typescript
export function TerrariumScene({ items }: { items: string[] }) {
  const onContextCreate = async (gl: ExpoWebGLRenderingContext) => {
    // 1. Renderer ìƒì„±
    const renderer = new Renderer({ gl });
    renderer.setSize(gl.drawingBufferWidth, gl.drawingBufferHeight);

    // 2. Scene + Camera ìƒì„±
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(
      50,
      gl.drawingBufferWidth / gl.drawingBufferHeight,
      0.1,
      100
    );
    camera.position.set(0, 2, 5);

    // 3. ì¡°ëª… ì¶”ê°€
    scene.add(new THREE.AmbientLight(0xffffff, 0.6));
    const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
    dirLight.position.set(5, 5, 5);
    scene.add(dirLight);

    // 4. ë Œë” ë£¨í”„
    const animate = () => {
      requestAnimationFrame(animate);
      // ìë™ íšŒì „
      scene.rotation.y += 0.005;
      renderer.render(scene, camera);
      gl.endFrameEXP(); // í•„ìˆ˜!
    };
    animate();
  };

  return <GLView style={{ flex: 1 }} onContextCreate={onContextCreate} />;
}
```

## 3D ì˜¤ë¸Œì íŠ¸ ì •ì˜

### ìœ ë¦¬ë³‘ (GlassJar)
```typescript
const jarGeometry = new THREE.SphereGeometry(1.5, 32, 32);
const jarMaterial = new THREE.MeshPhysicalMaterial({
  color: 0xffffff,
  transparent: true,
  opacity: 0.3,
  roughness: 0,
  transmission: 0.9,
});
```

### í™ (Soil)
```typescript
const soilGeometry = new THREE.CylinderGeometry(1.2, 1.2, 0.3, 32);
const soilMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
```

### ì´ë¼ (Moss) - êµ¬ì²´ í´ëŸ¬ìŠ¤í„°
```typescript
function createMoss(): THREE.Group {
  const group = new THREE.Group();
  const material = new THREE.MeshStandardMaterial({ color: 0x228B22 });

  for (let i = 0; i < 7; i++) {
    const sphere = new THREE.Mesh(
      new THREE.SphereGeometry(0.08, 8, 8),
      material
    );
    sphere.position.set(
      Math.random() * 0.3 - 0.15,
      Math.random() * 0.1,
      Math.random() * 0.3 - 0.15
    );
    group.add(sphere);
  }
  return group;
}
```

### ë²„ì„¯ (Mushroom) - ë°˜êµ¬ + ì›ê¸°ë‘¥
```typescript
function createMushroom(): THREE.Group {
  const group = new THREE.Group();

  // ê°“ (ë°˜êµ¬)
  const cap = new THREE.Mesh(
    new THREE.SphereGeometry(0.15, 16, 8, 0, Math.PI * 2, 0, Math.PI / 2),
    new THREE.MeshStandardMaterial({ color: 0xFF6B6B })
  );
  cap.position.y = 0.2;

  // ì¤„ê¸° (ì›ê¸°ë‘¥)
  const stem = new THREE.Mesh(
    new THREE.CylinderGeometry(0.05, 0.05, 0.2, 8),
    new THREE.MeshStandardMaterial({ color: 0xFFFFFF })
  );
  stem.position.y = 0.1;

  group.add(cap, stem);
  return group;
}
```

## ì„±ëŠ¥ ìµœì í™”

### ê¸ˆì§€ ì‚¬í•­
- âŒ drei íŒ¨í‚¤ì§€ ì‚¬ìš© (ëª¨ë°”ì¼ ë¯¸ì§€ì›)
- âŒ 100+ í´ë¦¬ê³¤ ë©”ì‹œ
- âŒ ì‹¤ì‹œê°„ ê·¸ë¦¼ì (Shadow)
- âŒ ê³ í•´ìƒë„ í…ìŠ¤ì²˜

### ê¶Œì¥ ì‚¬í•­
- âœ… ë‹¨ìˆœ geometryë§Œ ì‚¬ìš©
- âœ… segment ìˆ˜ ìµœì†Œí™” (16-32)
- âœ… MeshStandardMaterial ì‚¬ìš©
- âœ… ì¡°ëª… 2ê°œ ì´í•˜

## GL ë¯¸ì§€ì› ì‹œ í´ë°±
```typescript
function Terrarium2DFallback({ items }: { items: string[] }) {
  return (
    <View className="items-center justify-center h-80">
      <Text className="text-6xl">ğŸ«™</Text>
      <View className="absolute">
        {items.map(id => (
          <Text key={id}>{ITEMS.find(i => i.id === id)?.emoji}</Text>
        ))}
      </View>
    </View>
  );
}
```
