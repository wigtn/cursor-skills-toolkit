---
description: FE-1 ì—­í•  - Expo ë„¤ì´í‹°ë¸Œ ì•± (WebView + ë…¹ìŒ + STT + í…ìŠ¤íŠ¸ ì…ë ¥)
globs: app/**
alwaysApply: false
---

# FE-1: Expo ë„¤ì´í‹°ë¸Œ ì•± ë‹´ë‹¹
# ì ìš© ê²½ë¡œ: app/**

## ë‹´ë‹¹ ì˜ì—­
- `app/` í´ë” ë‚´ ëª¨ë“  íŒŒì¼
- Expo ì•± ì…‹ì—…, WebView í˜¸ìŠ¤íŒ…, ìŒì„± ë…¹ìŒ, Whisper STT, í…ìŠ¤íŠ¸ ì…ë ¥, ë„¤ì´í‹°ë¸Œ ê¸°ëŠ¥

## íŒŒì¼ êµ¬ì¡°
```
app/
â”œâ”€â”€ App.tsx                 # ë©”ì¸ ì•±: SafeArea + WebView + ë…¹ìŒ ë²„íŠ¼ + í…ìŠ¤íŠ¸ ì…ë ¥
â”œâ”€â”€ index.ts                # registerRootComponent(App)
â”œâ”€â”€ app.json                # Expo ì„¤ì • (orientation: portrait)
â”œâ”€â”€ tsconfig.json           # extends "expo/tsconfig.base", strict: true
â”œâ”€â”€ package.json
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ icon.png
â”‚   â”œâ”€â”€ splash-icon.png
â”‚   â”œâ”€â”€ adaptive-icon.png
â”‚   â””â”€â”€ favicon.png
â””â”€â”€ .gitignore
```

## í•µì‹¬ êµ¬í˜„ íŒ¨í„´ (ì‹¤ì œ ì½”ë“œ ê¸°ì¤€)

### App.tsx êµ¬ì¡°
```typescript
import { WebView } from 'react-native-webview';
import { useAudioRecorder, RecordingPresets } from 'expo-audio';
import { SafeAreaProvider, SafeAreaView } from 'react-native-safe-area-context';

// WebView URL ì„¤ì •
const WEB_URL = __DEV__
  ? Platform.select({
      ios: 'http://<ë¡œì»¬IP>:5173',      // ì‹¤ì œ IPë¡œ êµì²´
      android: 'http://10.0.2.2:5173',
      default: 'http://localhost:5173',
    })
  : 'https://your-deployed-url.com';

// API í‚¤ (í™˜ê²½ë³€ìˆ˜ ìš°ì„ , ì—†ìœ¼ë©´ ë”ë¯¸)
const OPENAI_API_KEY = process.env.EXPO_PUBLIC_OPENAI_API_KEY || 'YOUR_OPENAI_API_KEY';
```

### ë…¹ìŒ â†’ STT í”Œë¡œìš°
```
ì‚¬ìš©ì íƒ­ â†’ startRecording()
  â†’ expo-audio recorder.prepareToRecordAsync()
  â†’ recorder.record()
  â†’ sendToWebView('RECORDING_START', {})

ì‚¬ìš©ì ì¬íƒ­ â†’ stopRecording()
  â†’ recorder.stop()
  â†’ recorder.uri í™•ë³´
  â†’ API í‚¤ê°€ ë”ë¯¸? â†’ ëœë¤ ë”ë¯¸ ë¬¸ì¥ ì‚¬ìš©
  â†’ API í‚¤ê°€ ì‹¤ì œ? â†’ transcribeAudio(uri) â†’ Whisper API
  â†’ sendToWebView('VOICE_RESULT', { text })
```

### í…ìŠ¤íŠ¸ ì…ë ¥ í”Œë¡œìš° (ì‹ ê·œ)
```
ì‚¬ìš©ì í…ìŠ¤íŠ¸ ì…ë ¥ â†’ TextInputì— íƒ€ì´í•‘
  â†’ ì „ì†¡ ë²„íŠ¼ í´ë¦­ or í‚¤ë³´ë“œ ì œì¶œ
  â†’ sendToWebView('TEXT_INPUT', { text })
  â†’ ì…ë ¥ì°½ ì´ˆê¸°í™”
```

### sendToWebView êµ¬í˜„ (ì ˆëŒ€ íŒ¨í„´)
```typescript
const sendToWebView = (type: string, payload: object): void => {
  webViewRef.current?.injectJavaScript(
    `window.postMessage(JSON.stringify(${JSON.stringify({ type, payload })}), '*'); true;`
  );
};
```

### Whisper API í˜¸ì¶œ
```typescript
const transcribeAudio = async (audioUri: string): Promise<string> => {
  const formData = new FormData();
  formData.append('file', {
    uri: audioUri,
    type: 'audio/m4a',
    name: 'recording.m4a',
  } as unknown as Blob);
  formData.append('model', 'whisper-1');
  formData.append('language', 'ko');

  const response = await fetch('https://api.openai.com/v1/audio/transcriptions', {
    method: 'POST',
    headers: { Authorization: `Bearer ${OPENAI_API_KEY}` },
    body: formData,
  });
  const result = await response.json();
  return result.text;
};
```

### WebView í•„ìˆ˜ ì„¤ì •
```tsx
<WebView
  ref={webViewRef}
  source={{ uri: WEB_URL }}
  javaScriptEnabled={true}
  domStorageEnabled={true}
  allowsInlineMediaPlayback={true}
  mediaPlaybackRequiresUserAction={false}
  originWhitelist={['*']}
  onLoadEnd={() => setIsLoading(false)}
  onMessage={handleWebViewMessage}
  style={{ flex: 1 }}
/>
```

## í…ìŠ¤íŠ¸ ì…ë ¥ UI êµ¬í˜„ ê°€ì´ë“œ (ì‹ ê·œ)

### UI ë ˆì´ì•„ì›ƒ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   StatusBar (dark)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         â”‚
â”‚     WebView             â”‚  â† 3D ì”¬ (web/ í”„ë¡œì íŠ¸)
â”‚     (ì „ì²´ í™”ë©´)          â”‚
â”‚                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â” â”‚
â”‚ â”‚ TextInput       â”‚ â¤ â”‚ â”‚  â† í…ìŠ¤íŠ¸ ì…ë ¥ì°½ + ì „ì†¡ ë²„íŠ¼
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ¤ íƒ­í•˜ì—¬ ë…¹ìŒ]        â”‚  â† ë…¹ìŒ ë²„íŠ¼
â”‚  ë””ë²„ê·¸ í…ìŠ¤íŠ¸           â”‚  â† __DEV__ì¼ ë•Œë§Œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### TextInput ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
```typescript
import { useState } from 'react';
import { View, TextInput, TouchableOpacity, StyleSheet } from 'react-native';

const [inputText, setInputText] = useState('');

const handleTextSubmit = () => {
  if (!inputText.trim()) return;

  sendToWebView('TEXT_INPUT', { text: inputText.trim() });
  setInputText(''); // ì…ë ¥ì°½ ì´ˆê¸°í™”
};

// JSX
<View style={styles.inputContainer}>
  <TextInput
    style={styles.textInput}
    value={inputText}
    onChangeText={setInputText}
    onSubmitEditing={handleTextSubmit}
    placeholder="ë˜ë´‡ì—ê²Œ ëª…ë ¹í•´ë³´ì„¸ìš”..."
    placeholderTextColor="#999"
    returnKeyType="send"
  />
  <TouchableOpacity
    style={styles.sendButton}
    onPress={handleTextSubmit}
    disabled={!inputText.trim()}
  >
    <Text style={styles.sendButtonText}>â¤</Text>
  </TouchableOpacity>
</View>

// ìŠ¤íƒ€ì¼
const styles = StyleSheet.create({
  inputContainer: {
    flexDirection: 'row',
    alignItems: 'center',
    paddingHorizontal: 16,
    paddingVertical: 8,
    backgroundColor: '#f5f5f5',
    borderTopWidth: 1,
    borderTopColor: '#e0e0e0',
  },
  textInput: {
    flex: 1,
    height: 40,
    backgroundColor: '#fff',
    borderRadius: 20,
    paddingHorizontal: 16,
    fontSize: 16,
    borderWidth: 1,
    borderColor: '#ddd',
  },
  sendButton: {
    marginLeft: 8,
    width: 40,
    height: 40,
    borderRadius: 20,
    backgroundColor: '#4CAF50',
    justifyContent: 'center',
    alignItems: 'center',
  },
  sendButtonText: {
    color: '#fff',
    fontSize: 18,
  },
});
```

### ì…ë ¥ ëª¨ë“œ ì „í™˜ (ìŒì„±/í…ìŠ¤íŠ¸)
```typescript
// ì„ íƒì : ìŒì„±/í…ìŠ¤íŠ¸ ëª¨ë“œ ì „í™˜ ë²„íŠ¼ ì¶”ê°€
const [inputMode, setInputMode] = useState<'voice' | 'text'>('voice');

// ìŒì„± ëª¨ë“œ â†” í…ìŠ¤íŠ¸ ëª¨ë“œ ì „í™˜
<TouchableOpacity onPress={() => setInputMode(mode => mode === 'voice' ? 'text' : 'voice')}>
  <Text>{inputMode === 'voice' ? 'âŒ¨ï¸' : 'ğŸ¤'}</Text>
</TouchableOpacity>
```

## ìƒíƒœ ê´€ë¦¬ (App.tsx ë‚´ë¶€)
```typescript
const [isRecording, setIsRecording] = useState(false);
const [isLoading, setIsLoading] = useState(true);       // WebView ë¡œë”©
const [isProcessing, setIsProcessing] = useState(false); // STT ì²˜ë¦¬ ì¤‘
const [permissionGranted, setPermissionGranted] = useState(false);
const [statusText, setStatusText] = useState('');
const [inputText, setInputText] = useState('');          // í…ìŠ¤íŠ¸ ì…ë ¥ (ì‹ ê·œ)
```

## ë²„íŠ¼ ìƒíƒœë³„ í‘œì‹œ
| ìƒíƒœ | ì•„ì´ì½˜ | í…ìŠ¤íŠ¸ | ìƒ‰ìƒ |
|------|--------|--------|------|
| ê¸°ë³¸ | ğŸ¤ | íƒ­í•˜ì—¬ ë…¹ìŒ | ê¸°ë³¸ìƒ‰ |
| ë…¹ìŒ ì¤‘ | ğŸ”´ | ë…¹ìŒ ì¤‘... íƒ­í•˜ì—¬ ì¤‘ì§€ | ë¹¨ê°• |
| ì²˜ë¦¬ ì¤‘ | â³ | ìŒì„± ì¸ì‹ ì¤‘... | ì£¼í™© |
| ê¶Œí•œ ì—†ìŒ | ğŸ¤ | ë§ˆì´í¬ ê¶Œí•œ í•„ìš” | íšŒìƒ‰ |

## ì—ëŸ¬ í•¸ë“¤ë§ í•„ìˆ˜
- ë§ˆì´í¬ ê¶Œí•œ ê±°ë¶€ â†’ Alert í‘œì‹œ
- Whisper API ì‹¤íŒ¨ â†’ ì—ëŸ¬ ë¡œê·¸ + statusTextì— í‘œì‹œ
- API í‚¤ ì—†ìŒ â†’ ë”ë¯¸ ë¬¸ì¥ìœ¼ë¡œ í´ë°± (["ì•ˆë…•! ë°˜ê°€ì›Œ!", ...] ì¤‘ ëœë¤)
- WebView ë¡œë“œ ì‹¤íŒ¨ â†’ ë¡œë”© ì˜¤ë²„ë ˆì´ ìœ ì§€ + ì—ëŸ¬ í‘œì‹œ
- í…ìŠ¤íŠ¸ ì…ë ¥ ë¹ˆ ë¬¸ìì—´ â†’ ì „ì†¡ ë²„íŠ¼ ë¹„í™œì„±í™”

## ì˜ì¡´ì„± (package.json)
```json
{
  "dependencies": {
    "expo": "~54.0.33",
    "expo-audio": "^1.1.1",
    "expo-av": "*",
    "expo-status-bar": "*",
    "react": "19.1.0",
    "react-native": "0.81.5",
    "react-native-safe-area-context": "*",
    "react-native-webview": "13.15.0"
  }
}
```

## ìˆ˜ì • ê¸ˆì§€ ì˜ì—­
- `web/` í´ë” ì „ì²´
- `shared/` í´ë”ì˜ íƒ€ì… ì •ì˜ (ì‚¬ìš©ë§Œ ê°€ëŠ¥, ìˆ˜ì •ì€ AI-2 ë‹´ë‹¹)
- ë©”ì‹œì§€ ê·œê²© (RECORDING_START, VOICE_RESULT, TEXT_INPUT)ì˜ êµ¬ì¡° ë³€ê²½
